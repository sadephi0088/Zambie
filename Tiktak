import telebot

bot = telebot.TeleBot("7583760165:AAHzGN-N7nyHgFoWt9oamd2tgO7pLkKFWFs")
admin_id = 7341748124  # آیدی عددی تو عشقم
main_group_id = None
welcome_enabled = {}

@bot.message_handler(commands=['set'])
def set_group(message):
    global main_group_id
    if message.from_user.id == admin_id:
        main_group_id = message.chat.id
        welcome_enabled[main_group_id] = True
        bot.reply_to(message, "✅ این گروه به‌عنوان گروه اصلی تنظیم شد.")
    else:
        bot.reply_to(message, "🚫 فقط صاحب ربات می‌تونه این دستور رو بزنه.")

@bot.message_handler(commands=['dset'])
def disable_and_leave(message):
    global main_group_id
    if message.from_user.id == admin_id and message.chat.id == main_group_id:
        welcome_enabled[main_group_id] = False
        bot.reply_to(message, "❌ فعالیت ربات در این گروه متوقف شد و ربات خارج می‌شود.")
        bot.leave_chat(main_group_id)
        main_group_id = None
    else:
        bot.reply_to(message, "🚫 فقط صاحب ربات می‌تواند این دستور را در گروه اصلی اجرا کند.")

@bot.message_handler(commands=['wlc'])
def enable_wlc(message):
    if message.chat.id == main_group_id:
        welcome_enabled[main_group_id] = True
        bot.reply_to(message, "✅ خوش‌آمدگویی فعال شد.")
    else:
        bot.leave_chat(message.chat.id)

@bot.message_handler(commands=['dwlc'])
def disable_wlc(message):
    if message.chat.id == main_group_id:
        welcome_enabled[main_group_id] = False
        bot.reply_to(message, "❌ خوش‌آمدگویی غیرفعال شد.")
    else:
        bot.leave_chat(message.chat.id)

@bot.message_handler(content_types=['new_chat_members'])
def welcome_new_member(message):
    if message.chat.id != main_group_id or not welcome_enabled.get(main_group_id, False):
        bot.leave_chat(message.chat.id)
        return

    for user in message.new_chat_members:
        full_name = f"{user.first_name or ''} {user.last_name or ''}".strip()
        user_id = user.id
        username = f"@{user.username}" if user.username else "ندارد ❌"

        welcome_text = f"""
╔═━⊱🌟 TikTak • پیام ورود 🌟⊰━═╗  
🎉 خوش‌آمدی {full_name} عزیز! 🎉  

🆔 آیدی: `{user_id}`  
🔗 یوزرنیم: {username}

━━━━━━━━━━━━━━━━━━  
💖 حالا در جمعی قدم گذاشتی که همه، انتخاب‌شده‌ان...  
نشون بده که جای تو اینجاست — کنار خاص‌ترین‌ها 🌈💥  
━━━━━━━━━━━━━━━━━━  

📄 پروفایل اختصاصی‌ت ساخته شد!  
🎭 قدرت‌هات، افتخاراتت، امتیازاتت... همه اینجانست!

👁‍🗨 برای دیدنش، فقط توی گروه بنویس:  
/mee   👈
━━━━━━━━━━━━━━━━━━  
🌟 با عشق، تیم مدیریت TikTak Master
"""
        bot.send_message(message.chat.id, welcome_text, reply_to_message_id=message.message_id, parse_mode="Markdown")

@bot.message_handler(func=lambda message: True)
def unknown_commands(message):
    if message.chat.id != main_group_id:
        bot.leave_chat(message.chat.id)

bot.infinity_polling()
